import getQueryStringParameterByName from"../modules/QueryString.js";const priceId=getQueryStringParameterByName("priceId");main(priceId);async function main(a){if(!a)return void alert("Price not specified");const{publicKey:b}=await getConfig(),c=Stripe(b),d=c.elements(),f=createCard(d);f.mount("#card-element"),f.on("change",handleCardChange);const g=document.getElementById("payment-form");g.addEventListener("submit",async a=>{var b,d;a.preventDefault(),showLoadingStatus();const e=await c.createPaymentMethod({type:"card",card:f,billing_details:{name:null===(d=null===(b=window)||void 0===b?void 0:b.user)||void 0===d?void 0:d.email}});return e.error?void showFailedStatus(e.error.message):void(await registerPaymentMethod(e.paymentMethod.id),showSuccessStatus())})}function getConfig(){return fetch("/subscription/config").then(a=>a.json())}function registerPaymentMethod(a){const b={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:a})};return fetch("/subscription/register-payment-method",b).then(a=>a.json())}function createCard(a){return a.create("card",{style:{base:{color:"#32325d"}}})}function handleCardChange({error:a}){a?setErrorMessage(a.message):setErrorMessage("")}function setErrorMessage(a){const b=document.getElementById("card-errors");b.textContent=a}function showLoadingStatus(){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled"),document.querySelector("#payment-form").classList.add("status-loading")}function showFailedStatus(a){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled"),document.querySelector(".status-error").classList.add("visible"),setErrorMessage(a)}function showSuccessStatus(){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled");const a=document.querySelector(".status-success"),b=a.querySelector("a");b.click(),a.classList.add("visible")}function removeAllStatuses(){document.querySelector(".status-success").classList.remove("visible"),document.querySelector(".status-error").classList.remove("visible"),document.querySelector("#payment-form").classList.remove("status-loading")}